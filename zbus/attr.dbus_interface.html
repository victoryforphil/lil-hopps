<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Attribute macro for implementing a D-Bus interface."><title>dbus_interface in zbus - Rust</title><script> if (window.location.protocol !== "file:") document.write(`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2">`)</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-e935ef01ae1c1829.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="zbus" data-themes="" data-resource-suffix="" data-rustdoc-version="1.78.0 (9b00956e5 2024-04-29)" data-channel="1.78.0" data-search-js="search-42d8da7a6b9792c2.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-4c98445ec4002617.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-12cf3b4f4f9dc36d.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-04d5337699b92874.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc attr"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button><a class="logo-container" href="../zbus/index.html"><img src="https://storage.googleapis.com/fdo-gitlab-uploads/project/avatar/3213/zbus-logomark.png" alt=""></a></nav><nav class="sidebar"><div class="sidebar-crate"><a class="logo-container" href="../zbus/index.html"><img src="https://storage.googleapis.com/fdo-gitlab-uploads/project/avatar/3213/zbus-logomark.png" alt="logo"></a><h2><a href="../zbus/index.html">zbus</a><span class="version">3.15.2</span></h2></div><div class="sidebar-elems"></div></nav><div class="sidebar-resizer"></div>
    <main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../zbus/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Attribute Macro <a href="index.html">zbus</a>::<wbr><a class="attr" href="#">dbus_interface</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../src/zbus_macros/lib.rs.html#328">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>#[dbus_interface]</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Attribute macro for implementing a D-Bus interface.</p>
<p>The macro must be applied on an <code>impl T</code>. All methods will be exported, either as methods,
properties or signal depending on the item attributes. It will implement the <a href="https://docs.rs/zbus/3.0.0/zbus/trait.Interface.html"><code>Interface</code></a> trait
<code>for T</code> on your behalf, to handle the message dispatching and introspection support.</p>
<p>The methods accepts the <code>dbus_interface</code> attributes:</p>
<ul>
<li>
<p><code>name</code> - override the D-Bus name (pascal case form of the method by default)</p>
</li>
<li>
<p><code>property</code> - expose the method as a property. If the method takes an argument, it must be a
setter, with a <code>set_</code> prefix. Otherwise, it’s a getter. If it may fail, a property method must
return <code>zbus::fdo::Result</code>.</p>
</li>
<li>
<p><code>signal</code> - the method is a “signal”. It must be a method declaration (without body). Its code
block will be expanded to emit the signal from the object path associated with the interface
instance.</p>
<p>You can call a signal method from a an interface method, or from an <a href="https://docs.rs/zbus/3.0.0/zbus/struct.ObjectServer.html#method.with"><code>ObjectServer::with</code></a>
function.</p>
</li>
<li>
<p><code>out_args</code> - When returning multiple values from a method, naming the out arguments become
important. You can use <code>out_args</code> to specify their names.</p>
<p>In such case, your method must return a tuple containing
your out arguments, in the same order as passed to <code>out_args</code>.</p>
</li>
</ul>
<p>The <code>struct_return</code> attribute (from zbus 1.x) is no longer supported. If you want to return a
single structure from a method, declare it to return a tuple containing either a named structure
or a nested tuple.</p>
<p>Note: a <code>&lt;property_name_in_snake_case&gt;_changed</code> method is generated for each property: this
method emits the “PropertiesChanged” signal for the associated property. The setter (if it
exists) will automatically call this method. For instance, a property setter named <code>set_foo</code>
will be called to set the property “Foo”, and will emit the “PropertiesChanged” signal with the
new value for “Foo”. Other changes to the “Foo” property can be signaled manually with the
generated <code>foo_changed</code> method. In addition, a <code>&lt;property_name_in_snake_case&gt;_invalidated</code>
method is also generated that much like <code>_changed</code> method, emits a “PropertyChanged” signal
but does not send over the new value of the property along with it. It is usually best to avoid
using this since it will force all interested peers to fetch the new value and hence result in
excess traffic on the bus.</p>
<p>The method arguments support the following <code>zbus</code> attributes:</p>
<ul>
<li><code>object_server</code> - This marks the method argument to receive a reference to the
<a href="https://docs.rs/zbus/3.0.0/zbus/struct.ObjectServer.html"><code>ObjectServer</code></a> this method was called by.</li>
<li><code>connection</code> - This marks the method argument to receive a reference to the <a href="https://docs.rs/zbus/3.0.0/zbus/struct.Connection.html"><code>Connection</code></a> on
which the method call was received.</li>
<li><code>header</code> - This marks the method argument to receive the message header associated with the
D-Bus method call being handled.</li>
<li><code>signal_context</code> - This marks the method argument to receive a <a href="https://docs.rs/zbus/3.0.0/zbus/struct.SignalContext.html"><code>SignalContext</code></a> instance,
which is needed for emitting signals the easy way.</li>
</ul>
<h2 id="example"><a class="doc-anchor" href="#example">§</a>Example</h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>zbus_macros::dbus_interface;
<span class="kw">use </span>zbus::{ObjectServer, SignalContext, MessageHeader};

<span class="kw">struct </span>Example {
    _some_data: String,
}

<span class="attr">#[dbus_interface(name = <span class="string">"org.myservice.Example"</span>)]
</span><span class="kw">impl </span>Example {
    <span class="comment">// "Quit" method. A method may throw errors.
    </span><span class="kw">async fn </span>quit(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        <span class="attr">#[zbus(header)]
        </span>hdr: MessageHeader&lt;<span class="lifetime">'_</span>&gt;,
        <span class="attr">#[zbus(signal_context)]
        </span>ctxt: SignalContext&lt;<span class="lifetime">'_</span>&gt;,
        <span class="attr">#[zbus(object_server)]
        </span>_server: <span class="kw-2">&amp;</span>ObjectServer,
    ) -&gt; zbus::fdo::Result&lt;()&gt; {
        <span class="kw">let </span>path = hdr.path()<span class="question-mark">?</span>.unwrap();
        <span class="kw">let </span>msg = <span class="macro">format!</span>(<span class="string">"You are leaving me on the {} path?"</span>, path);
        Example::bye(<span class="kw-2">&amp;</span>ctxt, <span class="kw-2">&amp;</span>msg).<span class="kw">await</span><span class="question-mark">?</span>;

        <span class="comment">// Do some asynchronous tasks before quitting..

        </span><span class="prelude-val">Ok</span>(())
    }

    <span class="comment">// "TheAnswer" property (note: the "name" attribute), with its associated getter.
    // A `the_answer_changed` method has also been generated to emit the
    // "PropertiesChanged" signal for this property.
    </span><span class="attr">#[dbus_interface(property, name = <span class="string">"TheAnswer"</span>)]
    </span><span class="kw">fn </span>answer(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; u32 {
        <span class="number">2 </span>* <span class="number">3 </span>* <span class="number">7
    </span>}

    <span class="comment">// "IFail" property with its associated getter.
    // An `i_fail_changed` method has also been generated to emit the
    // "PropertiesChanged" signal for this property.
    </span><span class="attr">#[dbus_interface(property)]
    </span><span class="kw">fn </span>i_fail(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; zbus::fdo::Result&lt;i32&gt; {
        <span class="prelude-val">Err</span>(zbus::fdo::Error::UnknownProperty(<span class="string">"IFail"</span>.into()))
    }

    <span class="comment">// "Bye" signal (note: no implementation body).
    </span><span class="attr">#[dbus_interface(signal)]
    </span><span class="kw">async fn </span>bye(signal_ctxt: <span class="kw-2">&amp;</span>SignalContext&lt;<span class="lifetime">'_</span>&gt;, message: <span class="kw-2">&amp;</span>str) -&gt; zbus::Result&lt;()&gt;;

    <span class="attr">#[dbus_interface(out_args(<span class="string">"answer"</span>, <span class="string">"question"</span>))]
    </span><span class="kw">fn </span>meaning_of_life(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; zbus::fdo::Result&lt;(i32, String)&gt; {
        <span class="prelude-val">Ok</span>((<span class="number">42</span>, String::from(<span class="string">"Meaning of life"</span>)))
    }
}
</code></pre></div>
<p>See also <a href="https://docs.rs/zbus/3.0.0/zbus/struct.ObjectServer.html"><code>ObjectServer</code></a> documentation to learn how to export an interface over a <code>Connection</code>.</p>
</div></details></section></div></main></body></html>